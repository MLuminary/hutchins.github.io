---
title: 浅尝数据库
date: 2017-07-06 22:14:52
tags: 
  - mysql
  - sql
category: "数据库"
---
# 数据库概述

**服务器端** : 负责永久存储数据、维护数据，人不能直接观看。


**客户端** : 用于向服务器端发起“增删改查”命令.

# 使用MySQL服务器的步骤

## 服务器端：安装启动MySQL服务器端软件
    
×××/mysql/bin/mysqld.exe //deamon:精灵，守护者，服务器程序。

启动后，后台会有mysqld运行
port端口号:1~65535     命令行中输入netstat -ano可以查看占用的端口号,mysql默认端口号为3306。

## 安装一款MySQL客户端软件

phpstudy和xampp都可以，不过xampp只有32位，当然64位电脑也是可以支持32位的,两种都是MySQL源代码的一个分支
#### phpstudy
phpstudy的mysql是oracle的mysql,进入数据库服务器的时候命令行中显示的是``mysql>``
#### xampp
xampp的mysql是MariaDB,进入数据库服务器的时候命令行中显示的是``MariaDB[(none)]``这个有个好处是,你使用``use mysql``的时候,``MariaDB[(none)]``会变成``MariaDB[(mysql)]``,会告诉你现在在mysql这个数据库中，便于以后的操作.

<!--more-->

## 客户端：运行客户端程序连接到远程的服务器
    
1. 找到数据库中bin下的mysql.exe文件,用命令行方式登录的话,可以把文件拖到命令行中,一般端口号默认都是3306，就可以在路径后面直接敲入``-uroot -p``,然后他会提示你输入密码,xmapp默认密码为空,直接enter就ok了。如果提示密码不对的话可以去phpstudy里MySQL管理工具里面重置密码。
    
2. 在xampp中用Shell打开
用 ``mysql -uroot -p``登录

# MySQL常用管理命令

 >1. MySQL命令大小写都可以，推荐在编写关键字的时候用大写字母；非关键字可以小写
 >2. 都要以英文分号结尾

 ```SQL
 SHOW DATABASES;#显示服务器中当前所有的数据库名
 USE 库名;#进入指定的数据库  后面可以不写分号
 SHOW TABLES;#显示当前库中有哪些基本的表
 DESC 表名;#显示表结构，字段类型，主键，是否为空等，但不显示外键
 QUIT;#退出数据库,同理于ctrl+z
 SHOW CREATE TABLE 表名;#显示创建表的过程
 ```

# SQL语言

>结构化查询语言，专用于操作（增删改查）数据
>服务器中的数据。是一门国际标准化语言

## SQL常用语句

### DDL(数据定义语言)
- CREATE
  ```sql
  #创建新的数据库 其中的字符使用指定的编码
  CREATE DATABASE 数据库名 CHARSET=UTF8;
  #保证select的返回与编程编码一致
  set names utf8;
  #创建表(为方便演示,表名用 xz_user代替)
  CREATE TABLE xz_user(
      ur_id int,            #用户编号
      ur_name varchar(20),  #用户名字
      ur_pwd varchar(32),   #用户密码
      ur_email varchar(64), #用户邮箱
      ur_tel varchar(20)    #用户电话
  );
  ```
- DROP
  ```sql
  #丢弃一个已有的数据库（如果存在的话）
  DROP DATABASE IF EXISTS 数据库名;
  ```
- ALTER
  ```sql
  #删加列
  ALTER table_name DROP column column_name;
  ALTER table_name ADD column_name datatype;
  ```
- TRUNCATE
  ```sql
  #数据强制清除(直接将表删除后重建空表)
  TRUNCATE TABLE table_name;
  ```
### DML(数据操作语言)
- INSERT
```sql
#向用户表中插入数据
INSERT INTO xz_user VALUES (101,'Tom','10010','10010@qq.com','10000000000');
INSERT INTO xz_user(ur_id,ur_name) VALUES (101,'Tom')#剩下如果没有特殊的设置默认值的话为NULL
INSERT INTO xz_user VALUES(101,'Tom',
default,'10010@qq.com','100000000')#default处会是默认值
```
- DELETE
```sql
#删除数据
DELETE FROM xz_user;#删除xz_user表中的所有内容(慎用)
DELETE FROM xz_user WHERE ur_id = 15;#删除xz_user表中满足ur_id=15的行
```
- UPDATE
```sql
#修改数据
UPDATE 表名 SET 列=值,列=值,...;#这样会改所有的行(慎用)
UPDATE 表名 SET 列=值,列=值,...WHERE 列=值;#修改满足列的行 
UPDATE xz_user SET ur_id = 100 where ur_name = 'Tom';#将xz_user中ur_name为Tom的那一行的ur_id设置为100;
```
### DQL(数据查询语言)
```sql
#查询出表中已有的所有数据行
SELECT * FROM xz_user;
```
### DCL(数据控制语言)
- GRANT
  ```sql
  GRANT 权限 on 数据库对象 to 用户
  ```
- REVOKE
  ```sql
  REVOKE 权限名 FROM 用户
  ```

## MYSQL中的常用的列类型

### 数字类型

#### 整形

  - TINYINT:占1个字节 -128~127
  - SMALLINT:占2个字节 -32768~32767
  - INT：占4个字节 -2147483648~2147483647
  - BIGINT: Windows下为8个字节.有些系统也为4个字节

#### 浮点型

  - FLOAT(m,d) 单精度浮点型
  - DOUBLE(m,d) 双精度浮点型
  - DECIMAL(m,d) 严格定点数，用于精确计算

m表示总有效位数，d表示小数点后允许的有效位数

### 字符串类型

- CHAR(M) 固定长度字符串，M最大255
- VARCHAR(M) 长度可变的字符串，M最大为65535
- TEXT(M) 长度可变的字符串，M最大可以到2^32，即4G个字符

#### CHAR(8)和VARCHAR(8)有什么区别？

**CHAR(8)**：'a'实际存储为:'a\0\0\0\0\0\0\0'//\0代表空格

**VARCHAR(8)**：'a'实际存储为'a\0','abcdefgk'存储为'abcdefgk'

CHAR可能会产生空间浪费，但是读取稍快,VARCHAR读取速度稍慢，因为不知道字符串的真实长度.

### 日期时间类型

- DATE 'yyyy-mm-dd'
- TIME 'hh:mm:ss'
- DATETIME 'yyyy-mm-dd hh:mm:ss'

### 布尔类型
- BOOL/BOOLEAN:只能表示TRUE(等价于1)或    FALSE(等价于0)

## MySQL列约束

### 主键约束(PRIMARY KEY)
          
**语法**： ``列名 类型 PRIMARYKEY``<br>
声明为“主键”的列上不能出现NULL值，且不能重，所有的记录行自动按照主键列上的值排序,因此，主键只能有一个。

### 唯一约束(UNIQUE)

**语法**： ``列名 类型 UNIQUE``<br>
声明为“唯一”约束的列上不能出现重复值,但可以出现多可NULL

### 非空约束(NOT NULL)

**语法**： ``列名 类型 NOT NULL``<br>
声明为“非空”的列上不能出现NULL，但可以重复

### 检查约束(CHECK)//MYSQL不支持

限定指定列上的值必须满足特定条件

### 默认值约束(DEFAULT)

**语法**： ``列名 类型 DEFAULT 默认值``<br>
声明了默认值的列若未指定值，则使用默认值

### 外键约束(FOREIGN KEY)    
          
**语法**： ``FOREIGN KEY(列名) REFERENCES 表名（列名）``<br>
可重复可为空，外键列上出现的值必须在其参考的表的主键列上出现过

>如果为员工表添加了一个参考部门表的外键列，增加、修改员工都要查询一下部门表，操作效率会降低，老版本的MySQL是不支持的。  
>多个约束的话直接在后面写就可以。

## MySQL数据库中专有的“自增列”

AUTO_INCREMENT,只有MySQL支持，用于实现自增列.

插入时主键列如果没有给值，主键列的值会相应的设定为比当前已有的最大值多1的数字

**语法**：
  ```SQL
      CREATE TABLE xx(
      主键列名 INT PRIMARY KEY AUTO_INCREMENT,
          ...
      );
  ```

>提示：自增列只能用于主键列，且必须是整数型主键。自增列也可以手工赋值.

## select查询

### 只查特定的列

  **语法**: ``SELECT 列名,列名... FROM 表名;``

### 给列取别名

  **语法**: ``SELECT 列名 AS 别名,... FROM 表名;`` 或者 ``SELECT 列名 别名,... FROM 表名;``

### 只显示列上不同的值（即合并相同的值）  
  
  **语法**: ``SELECT DISTINCT 列名,列名... FROM 表名;``

### 按照指定列上的值排序

  **语法**: ``SELECT ... FROM 表名 ORDER BY 列名 [ASC];#升序（默认）`` 或者 ``SELECT ... FROM 表名 ORDER BY 列名 DESC;#降序``
  可以多次排序：``SELECT ... FROM 表名 ORDER BY 列名1,列名2;``#先根据第一个列排序，然后在这基础上再按照第二个排序

### 查询时进行运算

  直接在select后的列名上进行加减运算

### 查询出满足特定条件的记录行

  **语法**：``SELECT ... FROM ... WHERE 条件;``

  条件可以是多种表达式 : > = != < ....

  条件还可以是多种表达式的组合：AND OR NOT<br> 
  BETWEEN()AND() #在两个条件中间<br> 
  num IN(20,80,60) #num为20或80或60<br>
  num not in (20,80,60) #num不是20,80,60

  >**注意** : 和null比较的时候要用is 或者 is not<br> 
  >比如：``select * from price where pic is null;``

### 分页查询 --- LIMIT

  **语法**：``SELECT ... FROM ... WHERE ... ORDER BY... LIMIT start,count;``
  
  start:表示从满足条件的那一行记录开始读取，第一行称为0<br>
  count：此次最多读取多少行记录<br>
  假设每一页显示5条记录:<br>
  第1页:..LIMIT 0,5;
  第2页:..LIMIT 5,5;
  <br>个人理解名字应该为区间查询。start是开始行，count为结束行..

### 模糊查询 --- LIKE

  **语法**：``SELECT ... FROM ... WHERE 列名 LIKE '%e';#查询出以字母e结尾的信息``

  >在SQL查询中，%代表任意多个任意字符,_ 代表任意一个字符.

### 分组查询(group by)
  
  - COUNT:查询出满足条件的记录行数<br>
    **语法**：``SELECT COUNT(列名) FROM 表名``<br>
    计算对应列名中有多少行有效信息(非空);
  
  - MAX:查询指定列上的最大值<br>
    **语法**：``SELECT MAX(列名) FROM 表名``<br>

  - MIN:查询指定列上的最小值<br>
    **语法**：``SELECT MIN(列名) FROM 表名``<br>

  - AVG:查询指定列的平均值<br>
    **语法**：``SELECT AVG(列名) FROM 表名``<br>

  - SUM:查询指定列和<br>
    **语法**：``SELECT SUM(列名) FROM 表名``<br>

  >select ... group by 列名; #按照列名分类

### 子查询
    
  一条查询语句中再嵌入另一条查询，被嵌入的查询称为子查询

### 跨表查询

#### sql-92标准中的跨表查询无法显示连接条件为NULL的记录行。

**语法**：``SELECT 列名1,列名2 FROM 表1,表2 WHERE 表1.行1 = 表2.行1``<br>
跨表/多表查询，一次查询得到的结果集中的列来自于不同的表;跨表查询一定要防止出现笛卡尔积. 列名1来自表1，列名2来自表2，为防止笛卡尔积，要限制这两个表中的联系相等。

#### sql-99中标准

- 内连接（相当于sql-92语句的作用）<br>
``SELECT 列名1,列名2 FROM 表1 INNER JOIN 表2 ON 表1.行1 = 表2.行1``
- 左外连接（会显示出左侧表中所有记录）<br>
``SELECT 列名1,列名2 FROM 表1 LEFT OUTER JOIN 表2 ON 表1.行1 = 表2.行1``
- 右外连接（会显示出右侧表中所有记录）<br>
``SELECT 列名1,列名2 FROM 表1 RIGHT OUTER JOIN 表2 ON 表1.行1 = 表2.行1``
- 全连接（会显示两侧表中的记录）<br>
``SELECT 列名1,列名2 FROM 表1 FULL JOIN 表2 ON 表1.行1 = 表2.行1``

  >mysql不支持全连接

### 结果集合并
  - 合并结果集，结果只显示一次<br>
  ``SELECT 列名 FROM 表名 UNION SELECT 列名 FROM 表名``
  - 合并结果集，结果出现重复数据<br>
  ``SELECT 列名 FROM 表名 UNION ALL SELECT 列名 FROM 表名``

## 五丶 执行sql脚本文件

- 使用cmd命令执行(windows下，unix或linux在其控制台下)
     【Mysql的bin目录】\mysql –u用户名 –p密码 –D数据库<【sql脚本文件路径全名】，示例：
     D:\mysql\bin\mysql –uroot –p123456  -Dtest<d:\test\ss.sql
     **注意**：
     A、如果在sql脚本文件中使用了use 数据库，则-D数据库选项可以忽略
     B、如果【Mysql的bin目录】中包含空格，则需要使用“”包含，如：“C:\Program Files\mysql\bin\mysql” –u用户名 –p密码 –D数据库<【sql脚本文件路径全名】

-  进入mysql的控制台后，使用source命令执行
    Mysql>source 【sql脚本文件的路径全名】 或 Mysql>\. 【sql脚本文件的路径全名】，示例：
    source d:\test\ss.sql 或者 \. d:\test\ss.sql
   
- 用xampp的话,可以用面板的shell进入命令行中,用``mysql -uroot -p < sql脚本文件名``（默认无密码,有密码按提示输入密码就ok了）
  

## 六丶 <b>中文乱码问题</b>
``CREATE DATABASE 库名 CHARSET=UTF8``后只是数据库中应用UTF-8模式，此时sql语句也应该设置编码格式为UTF-8,在代码一开始要设置``SET NAMES UTF8``,此时用命令行进入数据库再敲入``select * from 表名``或者打开phpmyadmin查看,中文显示正常。但是你从外部导入sql文件查看的话永远都是乱码，但此时数据已经没问题了。

此问题只限于windows系统,因为windows的命令行默认编码为gbk,从外部导入sql直接查询的时候命令行并不会识别,虽然此时数据已经正常，但他显示的还是乱码，后来再进行操作的话便会显示正常。
