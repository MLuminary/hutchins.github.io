{"componentChunkName":"component---src-templates-post-detail-tsx","path":"/post-2018-07-17","webpackCompilationHash":"ac4f7e88a3f0fb43b9e3","result":{"data":{"site":{"siteMetadata":{"title":"Silence","author":"é»˜å°"}},"markdownRemark":{"id":"df8ee28f-75c6-5934-9920-1c7a4c639bf2","excerpt":"â€¦","html":"<blockquote>\n<p>è¿™æ®µæ—¶é—´ç»ˆäºæ„Ÿè§‰è‡ªå·±æ­¥å…¥æ­£è½¨ï¼Œä¹Ÿç›¸å¯¹ç¨³å®šäº†ä¸‹æ¥ã€‚ä¾¿æƒ³æç‚¹äº‹æƒ…ï¼Œæƒ³åšä¸€ä¸ªç½‘ç«™ï¼ŒåŒ…å«è‡ªå·±ä¸€äº›å¹³æ—¶æƒ³è¦çš„å·¥å…·å’Œä¸€äº›è‡ªå·±æƒ³å…³æ³¨çš„å’¨è¯¢ã€‚ç„¶åå‘ç°è‡ªå·±çš„æœåŠ¡å™¨ç«Ÿç„¶ä¸€ç‚¹éƒ½ä¸ç»¿ï¼Œæ‰€ä»¥å°±èŠ±äº†ä¸€äº›æ—¶é—´ç»¿åŒ–äº†è‡ªå·±çš„æœåŠ¡å™¨ ğŸŒ²â€¦</p>\n</blockquote>\n<h2>ç”³è¯·è¯ä¹¦</h2>\n<p>æˆ‘è‡ªå·±ç”¨çš„æ˜¯è…¾è®¯äº‘æœåŠ¡å™¨ï¼Œå› æ­¤è¯ä¹¦å°±å»è…¾è®¯äº‘å®˜æ–¹ç½‘ç«™å»ç”³è¯·ï¼Œå½“ç„¶ä¸æ˜¯è…¾è®¯äº‘çš„è¯è¿˜æœ‰å‡ ä¸ªæ¯”è¾ƒæƒå¨çš„é¢å‘è¯ä¹¦çš„ç½‘ç«™ï¼Œä¾‹å¦‚ <a href=\"https://www.startcomca.com\">StartSSL</a>ï¼Œå¦‚æœä½ çš„æœåŠ¡å™¨æ˜¯ Linux çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨é»˜è®¤å®‰è£…çš„ OpenSSL</p>\n<p>ä½†æ˜¯ OpenSSL çš„æ–¹æ³•æˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæ­¤ <a href=\"https://www.cnblogs.com/chjbbs/p/5748369.html\">é“¾æ¥</a></p>\n<p>è…¾è®¯äº‘çš„ç”³è¯·è¯ä¹¦è¿˜æ˜¯æ¯”è¾ƒç®€å•ï¼Œæ‰“å¼€æ­¤è¿°<a href=\"https://console.cloud.tencent.com/ssl\">é“¾æ¥</a></p>\n<p>ç‚¹å‡»ç”³è¯·è¯ä¹¦ï¼Œç„¶åæ ¹æ®å…¶æç¤ºä¸€æ­¥æ­¥å¡«å†™ï¼Œå®¡æ ¸æˆåŠŸåä¸‹è½½è¯ä¹¦ï¼Œä¸‹è½½è¯ä¹¦åé‡Œé¢çš„æ–‡ä»¶å¦‚ä¸‹</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 584px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/13038162da3d05a7d1b4a57d4a26f13e/3064a/pg1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.006849315068493%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAmUlEQVQY012Q2w6DIBBE+f+f5AUv3NRYgaLIdKGxgU5CwsPZswNsGkd4H1CSc67nuZe8Q8CyLNi2jTiP+07QWuM8z457wuZ5Jij/ZP/CIjHGVKlzDiklSCkRY+y4Z5ZxzuFoqE0r9t5BKQVrLY7jK5yoRGwati3ZIASEGKCkqi2u6+o2B1pWZOu6kvDATUJrDfb91XHlC8oLPtsCOCsM/oWIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pg1\"\n        title=\"pg1\"\n        src=\"/static/13038162da3d05a7d1b4a57d4a26f13e/3064a/pg1.png\"\n        srcset=\"/static/13038162da3d05a7d1b4a57d4a26f13e/cf440/pg1.png 148w,\n/static/13038162da3d05a7d1b4a57d4a26f13e/d2d38/pg1.png 295w,\n/static/13038162da3d05a7d1b4a57d4a26f13e/3064a/pg1.png 584w\"\n        sizes=\"(max-width: 584px) 100vw, 584px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>æ‰“å¼€ Nginxï¼Œé‡Œé¢åŒ…å«ç€ä¸€ä¸ªè¯ä¹¦æ–‡ä»¶å’Œä¸€ä¸ª <code class=\"language-text\">.key</code> æ–‡ä»¶ã€‚</p>\n<h2>é…ç½® nginx</h2>\n<p>æ‰“å¼€æœåŠ¡å™¨ä¸­çš„ <code class=\"language-text\">nginx/conf</code> æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸º <code class=\"language-text\">ssl</code>ï¼Œå†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸ºåŸŸåï¼Œè¿™ä¸ªå®Œå…¨çœ‹è‡ªå·±çš„ä¹ æƒ¯ï¼Œåœ¨åé¢çš„é…ç½®é¡¹ä¸­åªè¦è·¯å¾„å¯¹å°±å¯ä»¥ã€‚æˆ‘çš„è¯ä¹¦å’Œ <code class=\"language-text\">.key</code> æ–‡ä»¶çš„ä½ç½®å°±åœ¨ <code class=\"language-text\">nginx/conf/ssl/www.haoqinzz.cn/</code> ä¸‹</p>\n<p>ç„¶åæ‰¾åˆ° <code class=\"language-text\">nginx.conf</code> æ–‡ä»¶ï¼Œå°†å…¶ä¸­å¦‚ä¸‹ä»£ç è§£å¼€å°å°å¹¶ä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç </p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># HTTPS server</span>\n\n    server <span class=\"token punctuation\">{</span>\n       listen       <span class=\"token number\">443</span><span class=\"token punctuation\">;</span>\n       server_name  localhost<span class=\"token punctuation\">;</span>\n       ssl                  on<span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">       ssl_certificate      ssl/www.haoqinzz.cn/1_www.haoqinzz.cn_bundle.crt<span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\">       ssl_certificate_key  ssl/www.haoqinzz.cn/2_www.haoqinzz.cn.key<span class=\"token punctuation\">;</span></span>\n       ssl_session_timeout  5m<span class=\"token punctuation\">;</span>\n\n       ssl_protocols  SSLv2 SSLv3 TLSv1<span class=\"token punctuation\">;</span>\n       ssl_prefer_server_ciphers   on<span class=\"token punctuation\">;</span>\n\n       ssl_dhparam ssl/certs/dhparam.pem<span class=\"token punctuation\">;</span>\n       ssl_ciphers <span class=\"token string\">\"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4\"</span><span class=\"token punctuation\">;</span>\n       keepalive_timeout <span class=\"token number\">70</span><span class=\"token punctuation\">;</span>\n       ssl_session_cache shared:SSL:10m<span class=\"token punctuation\">;</span>\n\n       add_header Strict-Transport-Security max-age<span class=\"token operator\">=</span><span class=\"token number\">63072000</span><span class=\"token punctuation\">;</span>\n       add_header X-Frame-Options DENY<span class=\"token punctuation\">;</span>\n       add_header X-Content-Type-Options nosniff<span class=\"token punctuation\">;</span>\n\n\n       location / <span class=\"token punctuation\">{</span>\n           root   html<span class=\"token punctuation\">;</span>\n           index  index.html index.htm<span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>ç„¶åå†é‡å¯ä¸€ä¸‹ nginx æœåŠ¡å³å¯ï¼Œç„¶åè¾“å…¥ <a href=\"https://haoqinzz.cn\">https://haoqinzz.cn</a> å°±å¯ä»¥çœ‹åˆ° nginx çš„æ¬¢è¿é¡µï¼Œä½†æ­¤æ—¶ä½ è¾“å…¥ <a href=\"http://haoqinzz.cn\">http://haoqinzz.cn</a> è¿˜æ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦å…¨ç«™éƒ½ä¸Š https ï¼Œè¿˜éœ€è¦ä¿®æ”¹ http çš„æœåŠ¡ï¼Œå°† http é‡å®šå‘åˆ° https ä¸­ï¼Œ ç»§ç»­ä¿®æ”¹ nginx.conf æ–‡ä»¶</p>\n<div class=\"gatsby-highlight\" data-language=\"conf\"><pre class=\"language-conf\"><code class=\"language-conf\">server {\n    listen       80;\n    server_name  haoqinzz.cn www.haoqinzz.cn;\n    return 301 https://haoqinzz.cn$request_uri;\n}</code></pre></div>\n<p>è¿™æ ·ä½ è¾“å…¥ <a href=\"http://haoqinzz.cn\">http://haoqinzz.cn</a> ä¼šè·³åˆ° <a href=\"https://haoqinzz.cn\">https://haoqinzz.cn</a> ä¸­ï¼Œä½†æ˜¯ç°åœ¨è¿˜å­˜åœ¨ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¥å‰çš„é¡¹ç›®ä¹Ÿæ— æ³•è®¿é—®åˆ°äº†ã€‚ã€‚</p>\n<h2>è®©æœåŠ¡å™¨ä¸­çš„é¡¹ç›®é‡æ–°è¿è¡Œ</h2>\n<h3>åŸºæœ¬é¡¹ç›®</h3>\n<p>æœåŠ¡å™¨ä¸Š https åï¼Œé¦–é¡µæ”¹å˜äº†ï¼Œæ‰€æœ‰é¡¹ç›®éƒ½æ²¡äº†ï¼Œæˆ‘å°±å»çœ‹äº†ä¸€ä¸‹ nginx çš„é…ç½®æ–‡ä»¶</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># HTTPS server</span>\n\n    server <span class=\"token punctuation\">{</span>\n       listen       <span class=\"token number\">443</span><span class=\"token punctuation\">;</span>\n       server_name  localhost<span class=\"token punctuation\">;</span>\n\n       ssl                  on<span class=\"token punctuation\">;</span>\n       ssl_certificate      ssl/www.haoqinzz.cn/1_www.haoqinzz.cn_bundle.crt<span class=\"token punctuation\">;</span>\n       ssl_certificate_key  ssl/www.haoqinzz.cn/2_www.haoqinzz.cn.key<span class=\"token punctuation\">;</span>\n\n       ssl_session_timeout  5m<span class=\"token punctuation\">;</span>\n\n       ssl_protocols  SSLv2 SSLv3 TLSv1<span class=\"token punctuation\">;</span>\n       ssl_prefer_server_ciphers   on<span class=\"token punctuation\">;</span>\n\n       ssl_dhparam ssl/certs/dhparam.pem<span class=\"token punctuation\">;</span>\n       ssl_ciphers <span class=\"token string\">\"EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4\"</span><span class=\"token punctuation\">;</span>\n       keepalive_timeout <span class=\"token number\">70</span><span class=\"token punctuation\">;</span>\n       ssl_session_cache shared:SSL:10m<span class=\"token punctuation\">;</span>\n\n       add_header Strict-Transport-Security max-age<span class=\"token operator\">=</span><span class=\"token number\">63072000</span><span class=\"token punctuation\">;</span>\n       add_header X-Frame-Options DENY<span class=\"token punctuation\">;</span>\n       add_header X-Content-Type-Options nosniff<span class=\"token punctuation\">;</span>\n\n\n       location / <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">           root   html<span class=\"token punctuation\">;</span></span>           index  index.html index.htm<span class=\"token punctuation\">;</span>\n       <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>å‘ç° https çš„ root æ–‡ä»¶å¤¹ä¸º htmlï¼Œå› æ­¤æˆ‘å°†åŸæœ¬çš„æ–‡ä»¶è¿è¿‡æ¥å°±å¯ä»¥è®¿é—®äº† ğŸ˜¶</p>\n<h3>nginx åå‘ä»£ç†é¡¹ç›®</h3>\n<p>åœ¨æœåŠ¡å™¨ä¸Šæˆ‘è¿˜æœ‰è¿‡ä¸€ä¸ªç”¨ nginx å®ç°åå‘ä»£ç†çš„é¡¹ç›®ï¼Œå‡ https åæ¯«æ— ç–‘é—® api å…¨éƒ¨éƒ½æ˜¯ 404 äº†</p>\n<p>æ‰¾åˆ° nginx åå‘ä»£ç†çš„é…ç½®æ–‡ä»¶ï¼Œå°† Listen ç«¯å£ 80 æ”¹ä¸º 443 ï¼Œå¹¶å°†ä»¥å‰çš„ http åè®®éƒ½æ”¹ä¸º httpsï¼Œç„¶åæ­¤æ—¶å†æ‰“å¼€å°±å¯ä»¥æ‰¾åˆ° url ï¼Œä½†æ˜¯ä¼šæŠ¥ 502 é”™è¯¯ï¼Œç»è¿‡ä»”ç»†æ’æŸ¥åå‘ç°è¿™æ˜¯å› ä¸ºæˆ‘å½“æ—¶ç”¨ http èµ·çš„æœåŠ¡ï¼Œè¦æ”¹ä¸º https å¹¶é…ç½®è¯ä¹¦æ–‡ä»¶</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> https <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  key<span class=\"token punctuation\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keyæ–‡ä»¶'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  cert<span class=\"token punctuation\">:</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'crtæ–‡ä»¶'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> server <span class=\"token operator\">=</span> https<span class=\"token punctuation\">.</span><span class=\"token function\">createServer</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">,</span> app<span class=\"token punctuation\">)</span></code></pre></div>\n<p>è¿™æ ·æ•°æ®ä¾¿åˆå¯ä»¥è·å–åˆ°äº† âœŒï¸</p>","frontmatter":{"title":"è®©æœåŠ¡å™¨å¸¦ç‚¹ç»¿","date":"July 17, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/è®©æœåŠ¡å™¨å¸¦ç‚¹ç»¿/","previous":{"fields":{"slug":"/åŸºäº mpvue çš„åœ†å½¢è¿›åº¦æ¡ç»„ä»¶/"},"frontmatter":{"title":"åŸºäº mpvue çš„åœ†å½¢è¿›åº¦æ¡ç»„ä»¶","date":"2018-09-10"}},"next":{"fields":{"slug":"/è®°ä¸€æ¬¡ oneinstack é…ç½®æœåŠ¡å™¨/"},"frontmatter":{"title":"è®°ä¸€æ¬¡ oneinstack é…ç½®æœåŠ¡å™¨","date":"2018-07-15"}}}}}