{"componentChunkName":"component---src-templates-series-post-tsx","path":"/series/design-pattern/dan-li-mo-shi/","webpackCompilationHash":"ac4f7e88a3f0fb43b9e3","result":{"data":{"site":{"siteMetadata":{"title":"Silence","author":"默尝"}},"markdownRemark":{"id":"7590c3e5-8a76-5bf3-9c13-e16a1d199cc6","excerpt":"单例模式「Singleton Pattern…","html":"<blockquote>\n<p>单例模式「Singleton Pattern」：指一个类只有一个实例，且该类能自行创建这个实例的一种模式，为了节省内存资源、保证数据内容的一致性。</p>\n</blockquote>\n<h2>模式动机</h2>\n<p>在某些系统中，只有一个实例是非常必要的。比如任务管理器，首先从需求上来讲，一个任务管理器窗口完全满足需要。多个任务管理器窗口只会造成<strong>额外的开销</strong>，还需要处理各个窗口数据同步的问题。</p>\n<h2>实现</h2>\n<p>用一个变量来标记当前的类是否创建过对象，如果没创建过，返回创建之后的实例，如果之前已经创建过，<strong>则返回之前创建过的实例</strong>。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/55dfb63fa358a609f9c405363bcba1b1/6c7a0/task-manager.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.430939226519335%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA7klEQVQoz01RiQpAUBD0/7+nFFLIfd83o9la2Zq8xZtj19j3HeM4Yp5nTNP0nRXLsgi07/se933jeR6Bnll8GiTYtg3neeI4DsRxDNu24TgOyrL8BCh8XZcQKoGWkrMMuvpXURQIwxBRFMmZ30nYNA26rsO6rmjbFlmWIU1T+Zc9hYWQcfI8h2VZ4ohKdEtoMUFVVeLO8zwkSSI9BXm3rmvphVDnRCeMRbUgCOD7vqjyHV3RIS8SHI1GZVGI37/I/5lwhqZpimNG0jgUJhHJuYj//NjrciTyMAzikOBsXNeV2VCZcXXTBJ0o4X8ZWi+hlxue28MhSgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"单例模式「任务管理器」\"\n        title=\"单例模式「任务管理器」\"\n        src=\"/static/55dfb63fa358a609f9c405363bcba1b1/b9e4f/task-manager.png\"\n        srcset=\"/static/55dfb63fa358a609f9c405363bcba1b1/cf440/task-manager.png 148w,\n/static/55dfb63fa358a609f9c405363bcba1b1/d2d38/task-manager.png 295w,\n/static/55dfb63fa358a609f9c405363bcba1b1/b9e4f/task-manager.png 590w,\n/static/55dfb63fa358a609f9c405363bcba1b1/6c7a0/task-manager.png 724w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>代码</h3>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">TaskManage</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name\n<span class=\"token punctuation\">}</span>\n\nTaskManage<span class=\"token punctuation\">.</span>getInstance <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>instance<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TaskManage</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> instance\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 获取对象1</span>\n\n<span class=\"token keyword\">const</span> a <span class=\"token operator\">=</span> TaskManage<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 获取对象2</span>\n<span class=\"token keyword\">const</span> b <span class=\"token operator\">=</span> TaskManage<span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 进行比较</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>a <span class=\"token operator\">===</span> b<span class=\"token punctuation\">)</span> <span class=\"token comment\">// true</span></code></pre></div>\n<p>可以看到 <code class=\"language-text\">a</code> 和 <code class=\"language-text\">b</code> 是相等的，但是假如我们想让打开的英雄联盟也是单例，我们就必须再写一个英雄联盟的类，并添加 <code class=\"language-text\">getInstance</code> 方法，这样显然 <code class=\"language-text\">getInstance</code> 是重复编写的，我们可以将其抽出来单独作为一个类。</p>\n<h3>通用的单例中间类</h3>\n<p>首先我们将控制生成单例类的 <code class=\"language-text\">getInstance</code> 方法抽离出来</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 获取单独的实例</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">singleton</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> instance<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> instance <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">=</span> <span class=\"token function\">fn</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 个人认为这样也可以</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">singleton</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">Fn</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> instance\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> instance <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Fn</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>我们再编写一个任务管理器的类</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">taskManage</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">name</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n<span class=\"token punctuation\">}</span>\n\ntaskManage<span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">getName</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>name\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>然后我们将 <code class=\"language-text\">taskManage</code> 变为单例</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> TaskManageSingleton <span class=\"token operator\">=</span> <span class=\"token function\">singleton</span><span class=\"token punctuation\">(</span>taskManage<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> win <span class=\"token operator\">=</span> <span class=\"token function\">TaskManageSingleton</span><span class=\"token punctuation\">(</span><span class=\"token string\">'win'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> mac <span class=\"token operator\">=</span> <span class=\"token function\">TaskManageSingleton</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mac'</span><span class=\"token punctuation\">)</span>\n\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>win<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'win'</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span>mac<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 'win'</span></code></pre></div>\n<p>可以看到第二次调用 <code class=\"language-text\">TaskManageSingleton</code> 时传入的参数并未生效，可以得知返回的是之前已经生成的 <code class=\"language-text\">TaskManage</code> 实例。</p>\n<h2>小结</h2>\n<p>单例模式确保某一个类<strong>只有一个实例</strong>，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式的要点有三个：一是某个类只能有一个实例；二是它必须<strong>自行创建</strong>这个实例；三是它必须自行向整个系统提供这个实例。单例模式是一种对象创建型模式。</p>","frontmatter":{"title":"单例模式","date":"July 25, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/design-pattern/dan-li-mo-shi/","previous":{"fileAbsolutePath":"/Users/zhanghaoqin/gitMaster/Silence/content/series/design-pattern/guan-yu-javascript.md","fields":{"slug":"/design-pattern/guan-yu-javascript/"},"frontmatter":{"title":"关于 JavaScript","date":"2019-07-24"}},"next":{"fileAbsolutePath":"/Users/zhanghaoqin/gitMaster/Silence/content/series/design-pattern/gong-chang-mo-shi.md","fields":{"slug":"/design-pattern/gong-chang-mo-shi/"},"frontmatter":{"title":"工厂模式","date":"2019-07-26"}}}}}