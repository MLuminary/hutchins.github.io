{"componentChunkName":"component---src-templates-post-detail-tsx","path":"/react hooks å®ç° Mention/","webpackCompilationHash":"da4d36a0e3f3f1b53312","result":{"data":{"site":{"siteMetadata":{"title":"Silence","author":"é»˜å°"}},"markdownRemark":{"id":"6a5b7bfd-e3aa-59b4-9d95-87a5d5b3a877","excerpt":"Mention è®°å½•ä½¿ç”¨ hooks å®ç° mention ç»„ä»¶çš„å†ç¨‹ ğŸ’» State Props MeasureList ä½•æ—¶å‡ºç° MeasureList åœ¨è¿™ä»…ä»£è¡¨å‘¼å‡ºçš„æœç´¢ç»“æœåˆ—è¡¨ï¼Œå¾ˆå¤šäººå¯èƒ½é¦–å…ˆæƒ³åˆ°çš„æ˜¯åº”è¯¥è¦ç¡®å®š measureList å‡ºç°çš„ä½ç½®ï¼Œä½†å…¶å®æˆ‘ä»¬åªéœ€è¦åœ¨ measureListâ€¦","html":"<h1>Mention</h1>\n<blockquote>\n<p>è®°å½•ä½¿ç”¨ hooks å®ç° mention ç»„ä»¶çš„å†ç¨‹ ğŸ’»</p>\n</blockquote>\n<h2>State</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">measuring <span class=\"token comment\">// æµ‹é‡</span>\nmeasureLocation <span class=\"token comment\">// éœ€è¦å®šä½çš„ä½ç½®</span>\nmeasureText <span class=\"token comment\">// ç”¨äºæœç´¢çš„æœ¬æ–‡</span>\nmeasurePrefix <span class=\"token comment\">// å‘¼å‡º List çš„ç¬¦å· ä¾‹å¦‚ '@'</span>\nisESC <span class=\"token comment\">// ä½¿ç”¨ ESC å…³é—­</span>\nactiveIndex <span class=\"token comment\">// ç”¨äºé”®ç›˜äº‹ä»¶ä¸­ä¸Šä¸‹ç§»åŠ¨æœç´¢çš„åˆ—è¡¨</span></code></pre></div>\n<h2>Props</h2>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">type</span> Props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">setValue</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">value<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span>\n  value<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  trigger<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span> <span class=\"token comment\">// '@'</span>\n  <span class=\"token function-variable function\">onSearch</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">text<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// ä¼ é€’ MeasureText</span>\n  textareaRef<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span>RefObject<span class=\"token operator\">&lt;</span>HTMLTextAreaElement<span class=\"token operator\">></span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span>\n  style<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span>CSSProperties\n  className<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  onSelect<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params<span class=\"token punctuation\">:</span> ItemType</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span>\n  MenuClassName<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  mountIn<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> HTMLElement\n  loading<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">boolean</span>\n<span class=\"token punctuation\">}</span> <span class=\"token operator\">&amp;</span> Omit<span class=\"token operator\">&lt;</span>HTMLTextareaProps<span class=\"token punctuation\">,</span> <span class=\"token string\">'onSelect'</span><span class=\"token operator\">></span></code></pre></div>\n<h2>MeasureList ä½•æ—¶å‡ºç°</h2>\n<blockquote>\n<p><strong>MeasureList åœ¨è¿™ä»…ä»£è¡¨å‘¼å‡ºçš„æœç´¢ç»“æœåˆ—è¡¨</strong>ï¼Œå¾ˆå¤šäººå¯èƒ½é¦–å…ˆæƒ³åˆ°çš„æ˜¯åº”è¯¥è¦ç¡®å®š measureList å‡ºç°çš„ä½ç½®ï¼Œä½†å…¶å®æˆ‘ä»¬åªéœ€è¦åœ¨ measureList è¦å‡ºç°çš„æ—¶å€™å†è®¡ç®—å…¶ä½ç½®å°±å¯ä»¥ï¼Œæ‰€ä»¥é¦–å…ˆå¿…é¡»è¦ç¡®å®š measureList ä½•æ—¶å‡ºç°</p>\n</blockquote>\n<p><strong>è§„åˆ™ï¼š</strong></p>\n<ul>\n<li>å½“å…‰æ ‡å·¦ä¾§æœ‰ measurePrefix å­˜åœ¨å¹¶ä¸”ä¹‹é—´æ²¡æœ‰ç©ºæ ¼æ—¶, ä¹Ÿå°±æ˜¯ measureText ä¸å«æœ‰ç©ºæ ¼</li>\n<li>isESC ä¸º false æ—¶ã€Œä¸‹æ–‡è¯¦ç»†è§£é‡Šã€</li>\n</ul>\n<h3>è·å– MeasureText</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// è·å–å…‰æ ‡å·¦ä¾§çš„æ–‡æœ¬</span>\ntextareaValue<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> textAreaRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span>selectionStart<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// è·å–è·ç¦»å…‰æ ‡æœ€è¿‘çš„ MeasurePrefix çš„ä½ç½®, ä¹Ÿå°±æ˜¯éœ€è¦å®šä½çš„ä½ç½®</span>\n<span class=\"token keyword\">const</span> lastMeasurePrefixLocation <span class=\"token operator\">=</span> selectionStartText<span class=\"token punctuation\">.</span><span class=\"token function\">lastIndexOf</span><span class=\"token punctuation\">(</span>measurePrefix<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// å¦‚æœ lastMeasurePrefixLocation ä¸ç­‰äº -1 çš„æƒ…å†µä¸‹</span>\n<span class=\"token comment\">// æ­¤æ—¶ mesurePrefix ä½ç½®ä¸å…‰æ ‡ä½ç½®ä¹‹é—´çš„æ–‡æœ¬å³ä¸º measurePrefix</span>\n<span class=\"token keyword\">const</span> measureText <span class=\"token operator\">=</span> selectionStartText<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">(</span>\n  lastMeasurePrefixLocation <span class=\"token operator\">+</span> measurePrefix<span class=\"token punctuation\">.</span>length\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>å½“æ»¡è¶³ä»¥ä¸Šè§„åˆ™æ—¶ measuring ä¸º true</strong></p>\n<h2>MeasurePrefix çš„å®šä½</h2>\n<blockquote>\n<p>å½“ measureList å‡ºç°æ—¶ï¼Œéœ€è¦ç”¨ measurePrefix æ­¤æ—¶çš„ä½ç½®æ¥å¯¹ measureList è¿›è¡Œå®šä½</p>\n</blockquote>\n<p>åœ¨ textarea ä¸­åšå®šä½ç›¸å¯¹å›°éš¾ï¼Œå› æ­¤æˆ‘ä»¬é‡‡ç”¨ div æ¥æ¨¡æ‹Ÿ textarea ä¸­çš„æ–‡æœ¬æƒ…å†µå»å®ç° measurePrefix çš„å®šä½</p>\n<p><strong>é¦–å…ˆéœ€è¦å°† textarea ä¸­å½±å“æ–‡æœ¬æ ·å¼çš„ style åº”ç”¨åˆ° div ä¸­å»</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>textAreaRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> textareaCssProperties <span class=\"token operator\">=</span> <span class=\"token function\">getComputedStyle</span><span class=\"token punctuation\">(</span>textAreaRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      lineHeight<span class=\"token punctuation\">:</span> textareaCssProperties<span class=\"token punctuation\">.</span>lineHeight<span class=\"token operator\">!</span><span class=\"token punctuation\">,</span>\n      fontSize<span class=\"token punctuation\">:</span> textareaCssProperties<span class=\"token punctuation\">.</span>fontSize<span class=\"token operator\">!</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">setTextAreaStyle</span><span class=\"token punctuation\">(</span>style<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>textAreaRef<span class=\"token punctuation\">.</span>current <span class=\"token operator\">&amp;&amp;</span> textAreaRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>æ¨¡æ‹Ÿçš„ div å¦‚ä¸‹</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> measureContent <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n\t&lt;div style={textAreaStyle} className=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">classnames</span><span class=\"token punctuation\">(</span>\n    props<span class=\"token punctuation\">.</span>className<span class=\"token punctuation\">,</span>\n    Styles<span class=\"token punctuation\">[</span><span class=\"token string\">'measure-content'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">>\n\t\t&lt;span dangerouslySetInnerHTML={{ __html: escape(value.slice(0, measureLocation)) }} />\n\t\t&lt;span ref={measurePrefixRef}>@&lt;/span>\n\t\t&lt;span dangerouslySetInnerHTML={{ __html: escape(value.slice( measureLocation)) }} />\n  &lt;/div></span><span class=\"token template-punctuation string\">`</span></span>\n\n<span class=\"token comment\">// escape å‡½æ•°ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†å›è½¦é€ æˆçš„æ–‡æœ¬æ¢è¡Œï¼Œå¦‚æœä¸è½¬æ¢æˆ &lt;br> çš„è¯ï¼Œåœ¨ div ä¸­æ–‡æœ¬ä¼šæ˜¾ç¤ºæˆä¸€è¡Œ,å®šä½å°±ä¼šæœ‰é”™è¯¯ã€‚</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">escape</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">text<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> text<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/&lt;|>|`|\"|&amp;/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'?'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/\\r\\n|\\r|\\n/g</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&lt;br>'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æ¨¡æ‹Ÿ div çš„æ ·å¼éœ€è¦é¢å¤–æ·»åŠ ä¸€äº›å±æ€§æ¥ä½¿ div å®Œå…¨æ¨¡æ‹Ÿ textarea çš„è¡Œä¸ºï¼Œå½“ç„¶ text-area-autosize çš„è¡Œä¸ºä¹Ÿæ”¯æŒ</p>\n<div class=\"gatsby-highlight\" data-language=\"stylus\"><pre class=\"language-stylus\"><code class=\"language-stylus\"><span class=\"token selector\">.measure-content</span>\n  <span class=\"token property-declaration\"><span class=\"token property\">position</span> absolute</span>\n  <span class=\"token property-declaration\"><span class=\"token property\">top</span> <span class=\"token number\">0</span></span>\n  <span class=\"token property-declaration\"><span class=\"token property\">right</span> <span class=\"token number\">0</span></span>\n  <span class=\"token property-declaration\"><span class=\"token property\">bottom</span> <span class=\"token number\">0</span></span>\n  <span class=\"token property-declaration\"><span class=\"token property\">left</span> <span class=\"token number\">0</span></span>\n  <span class=\"token property-declaration\"><span class=\"token property\">z-index</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span></span>\n  <span class=\"token property-declaration\"><span class=\"token property\">overflow</span> scroll</span>\n  <span class=\"token property-declaration\"><span class=\"token property\">white-space</span> pre-wrap</span>\n  <span class=\"token property-declaration\"><span class=\"token property\">word-break</span> break-all</span>\n  <span class=\"token property-declaration\"><span class=\"token property\">opacity</span> <span class=\"token number\">0</span></span></code></pre></div>\n<p>æ³¨æ„å…¶å…±åŒçš„çˆ¶ div éœ€è¦æ·»åŠ  <code class=\"language-text\">position: relative</code></p>\n<h2>MeasureList ä½•æ—¶éšè—</h2>\n<ol>\n<li>å½“ measureText ä¸­åŒ…å«ç©ºæ ¼æ—¶</li>\n<li>å½“é€‰ä¸­ MeasureList ä¸­çš„æŸä¸€ä¸ª item æ—¶ã€Œç‚¹å‡»æˆ– Enterã€</li>\n<li>å½“æŒ‰ä¸‹ ESC é”®æ—¶</li>\n<li>å½“å…‰æ ‡çš„å·¦ä¾§æ—  measurePrefix æ—¶</li>\n</ol>\n<h3>æ³¨æ„</h3>\n<p>æŒ‰ä¸‹ ESC é”®æ—¶ï¼Œæ­¤æ—¶ measureText ä¸­ä¸ä¼šåŒ…å«ç©ºæ ¼ï¼Œå› æ­¤ä¾ç„¶æ»¡è¶³ measuring ä¸º true çš„æƒ…å†µï¼Œæ‰€ä»¥éœ€è¦å¯¹ ESC è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼šå½“ measuring ä¸º true æ—¶æŒ‰ä¸‹ ESC é”®æ—¶æˆ‘ä¼šå°† isESC ç½®ä¸º trueï¼Œè€Œå½“ isESC ä¸º true æ—¶ measuring åˆ™è‡³ä¸º falseã€‚isESC ä¼šåœ¨ä¸‹æ¬¡æ™®é€šçš„ keyUp äº‹ä»¶ä¸­é‡æ–°ç½®ä¸º false</p>\n<p><a href=\"https://github.com/MLuminary/Blog/issues/21\">åŸæ–‡é“¾æ¥</a></p>","frontmatter":{"title":"è®°å½•ä½¿ç”¨ hooks å®ç° mention ç»„ä»¶çš„å†ç¨‹","date":"September 20, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/react hooks å®ç° Mention/","previous":null,"next":{"fields":{"slug":"/<Element /"},"frontmatter":{"title":"<Element /> ä¸ renderElement"}}}}}