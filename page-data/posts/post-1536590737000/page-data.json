{"componentChunkName":"component---src-templates-post-detail-tsx","path":"/posts/post-1536590737000","result":{"data":{"site":{"siteMetadata":{"title":"Silence","author":"默尝"}},"markdownRemark":{"id":"f96d5251-7a2d-55f1-b29e-41c216dc7aaf","excerpt":"自己本身是一个微信小程序小白，前几天刚开始学习。碰到一个需求是要实现多个圆形带缺口的进度条，在网上没有找到相关插件后决定自己编写一个。mini-circleprogress 源码 效果   完全响应式 适应包裹元素的宽度和高度 一开始的思路是设置 canvas 的宽高为 10…","html":"<blockquote>\n<p>自己本身是一个微信小程序小白，前几天刚开始学习。碰到一个需求是要实现多个圆形带缺口的进度条，在网上没有找到相关插件后决定自己编写一个。<a href=\"https://github.com/MLuminary/subentry/tree/master/mini-circleProgress\">mini-circleprogress 源码</a></p>\n</blockquote>\n<h2>效果</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 128px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/476ed8a7baa845806cae059d9444b393/474e0/default.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.09374999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe+ySwAAf//EABgQAAMBAQAAAAAAAAAAAAAAAAECECAx/9oACAEBAAEFAsBQs7f/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAUEAEAAAAAAAAAAAAAAAAAAAAw/9oACAEBAAY/Ah//xAAZEAEAAwEBAAAAAAAAAAAAAAABABARMUH/2gAIAQEAAT8htzj7ORtIDE2ABhX/2gAMAwEAAgADAAAAENPAPP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8QH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8QH//EABsQAQEAAgMBAAAAAAAAAAAAAAERADEQIVFB/9oACAEBAAE/EN5POLlz5C7xxX23W3DWTCHiXBQQNcf/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"基于 mpvue 的圆形进度条组件\"\n        title=\"基于 mpvue 的圆形进度条组件\"\n        src=\"/static/476ed8a7baa845806cae059d9444b393/474e0/default.jpg\"\n        srcset=\"/static/476ed8a7baa845806cae059d9444b393/474e0/default.jpg 128w\"\n        sizes=\"(max-width: 128px) 100vw, 128px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 127px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8fd6a14a4f48101135058fc5b477bbd3/b308d/gap.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.91338582677166%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe+nCwAAf//EABcQAAMBAAAAAAAAAAAAAAAAAAECIBH/2gAIAQEAAQUCgLk//8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGRAAAQUAAAAAAAAAAAAAAAAAAAEQESAx/9oACAEBAAY/Ang1a//EABkQAQEAAwEAAAAAAAAAAAAAAAERABAgcf/aAAgBAQABPyHdFXltp68//9oADAMBAAIAAwAAABDjzzz/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EB//xAAVEQEBAAAAAAAAAAAAAAAAAAARIP/aAAgBAgEBPxAj/8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAMRAhUZH/2gAIAQEAAT8QuLG7gK9HRBmBiwwXBFt5/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"基于 mpvue 的圆形进度条组件\"\n        title=\"基于 mpvue 的圆形进度条组件\"\n        src=\"/static/8fd6a14a4f48101135058fc5b477bbd3/b308d/gap.jpg\"\n        srcset=\"/static/8fd6a14a4f48101135058fc5b477bbd3/b308d/gap.jpg 127w\"\n        sizes=\"(max-width: 127px) 100vw, 127px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>完全响应式</h2>\n<p><strong>适应包裹元素的宽度和高度</strong></p>\n<p>一开始的思路是设置 canvas 的宽高为 100%，发现并没有什么用，然后想获取 <code class=\"language-text\">canvas</code> 动态改变其宽高，发现小程序不能操作 dom, <code class=\"language-text\">ref</code> 也都不能使用。因此只能设置一个 <code class=\"language-text\">props</code>,麻烦使用者告知一下父元素的宽高，在这里因为此图形是一个圆形，所以只需要传递一个值就可以了。</p>\n<p><strong>适应设备的宽度和高度</strong></p>\n<p><code class=\"language-text\">canvas</code> 中的画布单位默认都是 px，画出来的图形是不能很好的适应宽度不同的设备的，因此自己在内部实现了一个 rpx，具体实现思路如下</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">getRpx</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> rpx <span class=\"token operator\">=</span> <span class=\"token number\">1</span> <span class=\"token comment\">// 相对单位</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    wx<span class=\"token punctuation\">.</span><span class=\"token function\">getSystemInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        rpx <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>windowWidth <span class=\"token operator\">/</span> <span class=\"token number\">375</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>rpx<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>然后与之前的画布的数值相乘即可，想具体看怎么实现的可以去看下<a href=\"https://github.com/MLuminary/subentry/tree/master/mini-circleProgress\">源码</a></p>\n<h2>有关 canvas-id</h2>\n<p>canvas 在一个页面中 id 是不能相同的，就算出现相同的也只会渲染第一个，因此需要多个 <code class=\"language-text\">canvas</code> 只能让其 id 各不相同。使用者想使用多个圆形进度条组件的时候，请传递 <code class=\"language-text\">canvasId</code> 值。</p>","frontmatter":{"title":"基于 mpvue 的圆形进度条组件","date":"September 10, 2018"}}},"pageContext":{"slug":"/基于 mpvue 的圆形进度条组件/","previous":{"fields":{"slug":"/根据 url 获取图标及 title/"},"frontmatter":{"title":"根据 url 获取图标及 title","date":"2018-09-24 22:45:37"}},"next":{"fields":{"slug":"/让服务器带点绿/"},"frontmatter":{"title":"让服务器带点绿","date":"2018-07-17 21:09:47"}},"prePath":"/posts/post-1537800337000","nextPath":"/posts/post-1531832987000"}},"staticQueryHashes":["1747850863","63159454"]}